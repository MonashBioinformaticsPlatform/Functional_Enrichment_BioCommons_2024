---
title: "WebGestaltR"
output: html_notebook
---



~~~~
Participants to save, KNIT, and close their clusterProfiler/gProfielr workbook
Clear RStudio environment
Open provided code for webgestaltR analysis that inputs a human gene list - but they will need to change it to analyse mouse! Ie update the filepath in the provided R code
Challenge activity -  adjust to a new species: on google, find the R PDF user guide for WebGestaltR
Find the function to list support organisms and run it - they can do this in the console directly, or add the command to their notebook 
Find where in the code the input data is loaded - and replace it to the mouse dataset that they have been provided in the day 2 folder
Find where in the R code the organism is specified as human and change it to mouse 
Head of the data - genes are in <NAMESPACE>
Check the PDF to find the function to list supported namespaces and run it - identify what syntax is required to provide the right namespace to the analysis code and update it as required
Run WebGestaltR - super simple to change the DB and analysis type so we can run a few. No need to provide plot code for this one since the HTMLs cover that
Show the lovely report HTMLs that are saved to disk - open these in browser, review the different plots, show how users can download data and GMT files from here 
Focus on GO hierarchy and redundant terms: 
Run GO_MF regular vs GO_MF_nonRedudnant
Highlight the  differences - check the number of significant terms (either from R CLI or HTML report or both - plot venn, print out the unique terms
Focus on one of the unique terms, show what has been dropped from the non-redundant analysis and the parent-child hierarchy on GO. 
This neat feature of WebGestatlR saves using topGO or rrvgo
Drops the generic higher order parent terms so we have fewer more specific terms to focus on

~~~

# [WebgestaltR](https://cran.r-project.org/web/packages/WebGestaltR/WebGestaltR.pdf)

enrichMethod organism Enrichment methods: ORA, GSEA or NTA.
NTA = network topology analysis

makes great html reports with interactive plots

```{r view organisms }
listOrganism()
```
```{r list available namespace options}

listIdType()

```


```{r}
#enrichDatabase : The functional categories for the enrichment analysis. Users can use the function listGeneSet to check the available functional databases for the selected organism. Multiple databases in a vector are supported for ORA and GSEA
listGeneSet()

```

```{r webgestalt ORA GO MF }

outputDirectory <- getwd() 
project <- "webgestaltR_GOMF"

wg_ora_go_mf <- WebGestaltR(
    organism = "hsapiens",                   # Use your species (e.g., "hsapiens" for humans)
    enrichMethod = "ORA",                    # Perform ORA, GSEA or NTA
    interestGene = ora_gene_list,                # Your gene list
    interestGeneType = "ensembl_gene_id",         # Specify the gene ID type
    referenceGene = background_gene_list,                    # Use the default background or provide your own
    referenceGeneType = "ensembl_gene_id",        # Background gene ID type (if using a custom background)
    enrichDatabase = "geneontology_Molecular_Function",  # The database for enrichment analysis
    isOutput = TRUE,                        # Set to FALSE if you don't want files saved to disk
    fdrMethod = "BH",                        # Correction method (e.g., Benjamini-Hochberg)
    sigMethod = "fdr",                       # Significance method ('fdr' or 'top')
    fdrThr = 0.05,                           # FDR significance threshold
    minNum = 5,                              # Minimum number of genes per category
    maxNum = 500,                             # Maximum number of genes per category
    boxplot = TRUE,
    outputDirectory = outputDirectory,
    projectName = project
)


```{r webgestalt ORA GO MF non-redundant }

outputDirectory <- getwd() 
project <- "webgestaltR_GOMF_noRedundant"

wg_ora_go_mf_nr <- WebGestaltR(
    organism = "hsapiens",                   # Use your species (e.g., "hsapiens" for humans)
    enrichMethod = "ORA",                    # Perform ORA, GSEA or NTA
    interestGene = ora_gene_list,                # Your gene list
    interestGeneType = "ensembl_gene_id",         # Specify the gene ID type
    referenceGene = background_gene_list,                    # Use the default background or provide your own
    referenceGeneType = "ensembl_gene_id",        # Background gene ID type (if using a custom background)
    enrichDatabase = "geneontology_Molecular_Function_noRedundant",  # The database for enrichment analysis
    isOutput = TRUE,                        # Set to FALSE if you don't want files saved to disk
    fdrMethod = "BH",                        # Correction method (e.g., Benjamini-Hochberg)
    sigMethod = "fdr",                       # Significance method ('fdr' or 'top')
    fdrThr = 0.05,                           # FDR significance threshold
    minNum = 5,                              # Minimum number of genes per category
    maxNum = 500,                             # Maximum number of genes per category
    boxplot = TRUE,
    outputDirectory = outputDirectory,
    projectName = project
)

```


Maybe a good activity for activity 2: use list organism to work out how to change to mouse, run the 'noRedundant vs redundant'. and compare. show how can minimise false positives. 

Did this for Pezzini ORA GO MF: eg "binding" - there were 85 from the GO MF db and 34 from the GO MF noRedundant set. 

Use R to filter which ones were dropped, and then show the GO hierarchy for one example parent term, show how the signiicant child term remaisn in the "no redundant" - helps to isoalt emore important results 

Compare the enriched terms:

Visulaise the number of unique and shared terms: 

```{r Compare redundant v non-redundant}

nr_terms <- wg_ora_go_mf_nr$geneSet
r_terms <- wg_ora_go_mf$geneSet

# Find unique terms
unique_nr_terms <- setdiff(nr_terms, r_terms)
unique_r_terms <- setdiff(r_terms, nr_terms)

# Display the count of unique terms
cat("Number of unique NR terms:", length(unique_nr_terms), "\n")
cat("Number of unique R terms:", length(unique_r_terms), "\n")

# Display the unique terms themselves
cat("Unique NR terms:\n", unique_nr_terms, "\n")
cat("Unique R terms:\n", unique_r_terms, "\n")
```

Check one of those terms that are unique to NR: 


```{r check unique term}
wg_ora_go_mf_nr[wg_ora_go_mf_nr$geneSet == "GO:0008227", c("geneSet", "description")]
```

```{r review term in redundant}

search <- "G protein-coupled"

wg_ora_go_mf[grep(search, wg_ora_go_mf$description, ignore.case = TRUE), c("geneSet", "description")]
```


```{r now review term in non-redundant}

wg_ora_go_mf_nr[grep(search, wg_ora_go_mf_nr$description, ignore.case = TRUE), c("geneSet", "description")]

```

So we have one term common to both - G protein-coupled receptor binding. Yet 2 terms in the redundant set, and 1 unique term in the non-redundant. How are they related? 


Click Neighborhood

Extract the tables of the erniched terms, names, and FDR:

```{r}
nr_df <- data.frame(
  GeneSet = wg_ora_go_mf_nr$geneSet,
  Description = wg_ora_go_mf_nr$description,
  FDR =wg_ora_go_mf_nr$FDR,
  stringsAsFactors = FALSE  
)


r_df <- data.frame(
  GeneSet = wg_ora_go_mf$geneSet,
  Description = wg_ora_go_mf$description,
  FDR =wg_ora_go_mf$FDR,
  stringsAsFactors = FALSE  
)

write.table(nr_df, "wg_ora_go_mf_nr.tsv", sep = "\t", row.names = TRUE, quote = FALSE)
write.table(r_df, "wg_ora_go_mf.tsv", sep = "\t", row.names = TRUE, quote = FALSE)

```

```{r Plot redundant v non-redundant}

venn.plot <- venn.diagram(
  x = list(Redundant = r_terms, NonRedundant = nr_terms),
  category.names = c("Redundant", "Non-Redundant"),
  filename = NULL,  # Keeps the plot in the R session
  fill = c("cornflowerblue", "lightpink"),
  alpha = 0.5,
  cex = 2,
  cat.cex = 1.5,
  main = "Comparison of Enriched Terms"
)
grid.newpage() # required this, in order to render inside notebook  - library(grid)
grid.draw(venn.plot)

```

Can we check the differences against the GO hierarchy to see what ahs been dropped/collapsed/popped out as unique? 


```{r GSEA example }

#rankFile <- system.file("extdata", "GeneRankList.rnk", package="WebGestaltR")

outputDirectory <- getwd() 

#gsea_vector <- setNames(gsea_gene_list$Log2FC, gsea_gene_list$Gene.ID)

enrichResult <- WebGestaltR(enrichMethod="GSEA", 
  organism="hsapiens",
  enrichDatabase="pathway_KEGG",
  interestGene=gsea_gene_list,
  interestGeneType="ensembl_gene_id",
  sigMethod="top",
  topThr=10,
  minNum=5,
  outputDirectory=outputDirectory)

```



``` {r NTA example }

####### NTA example ######### 
enrichResult <- WebGestaltR(enrichMethod="NTA",
  organism="hsapiens",
  enrichDatabase="network_PPI_BIOGRID",
  interestGene=ora_gene_list,
  interestGeneType="ensembl_gene_id",
  sigMethod="top",
  topThr=10,
  outputDirectory=getwd(),
  highlightSeedNum=10,
  networkConstructionMethod="Network_Retrieval_Prioritization")



```


